/*!build time : 2014-05-13 9:03:25 PM*/
KISSY.add("gallery/kissy-portal/1.0/index",function(a,b,c,d,e,f,g){"use strict";var h="",i=e.DraggableDelegate,j=e.DroppableDelegate,k={id:{value:h},cols:{value:3},colWidth:{value:300},header:{value:'<div class="ui-portlet-header"><span class="title"></span><span class="close"></span><span class="resize"></span><span class="refresh clearfix"></span></div>'},content:{value:'<div class="ui-portlet-content"></div>'},tpl:{value:'<div class="ui-portlet-item"></div>'}},l={initializer:function(){var a=this;a._initAttr(),a._bindEvent()},_initAttr:function(){var b=this;b.wrap=a.one("#"+b.get("id")),b.cols=a.isNumber(b.get("cols"))?b.get("cols"):3,b.colWidth=a.isNumber(b.get("colWidth"))?b.get("colWidth"):300,b.portlets=b.wrap.children("div"),b._create()},_create:function(){var b=this;b.colWraps=[],b.wrap.addClass("ui-portlet clearfix");for(var c=b.cols-1;c>=0;c--)b.colWraps[c]=a.one('<div class="ui-portlet-column'+(c==b.cols-1?" last clearfix":"")+'"></div>').width(b.colWidth),b.wrap.prepend(b.colWraps[c]);b._createPortletsFromHtml(),b._initDD()},_createPortletsFromHtml:function(){var b=this;b.portlets&&b.portlets.length>0&&(a.each(b.portlets,function(c){var d=b.wrap.one(c),e=a.isString(d.attr("title"))?d.attr("title"):h,f=a.isString(d.attr("width"))?d.attr("width"):"100%",g=a.isString(d.attr("height"))?d.attr("height"):"auto",i=d.attr("pos").split(",");a.isArray(i)&&2==i.length||(i=[1,1]),d.wrapInner(b.get("content")),d.prepend(b.get("header")),a.one(".title",d).html(e),a.one(".ui-portlet-content",d).width(f).height(g),d.addClass("ui-portlet-item").removeAttr("title"),a.one(d).appendTo(b.colWraps[i[1]-1])}),a.each(b.colWraps,function(){}))},_bindEvent:function(){var a=this;d.delegate(a.wrap,"click",".refresh",a._refreshHanddler),d.delegate(a.wrap,"dblclick",".refresh",a._haltHandler),d.delegate(a.wrap,"click",".resize",a._resizeHandler),d.delegate(a.wrap,"dblclick",".resize",a._haltHandler),d.delegate(a.wrap,"click",".close",a._closeHandler),d.delegate(a.wrap,"dblclick",".close",a._haltHandler)},_refreshHanddler:function(b){var c=a.one(b.currentTarget),d=c.parent(".ui-portlet-item");that.fire("refresh",a.one(".ui-portlet-content",d))},_resizeHandler:function(b){var c=this,d=a.one(b.currentTarget),e=d.parent(".ui-portlet-item");a.one(".resize",e).toggleClass(".plus"),a.one(".ui-portlet-content",e).toggle(),c.fire("resize",a.one(".ui-portlet-content",e))},_closeHandler:function(b){var c=this,d=a.one(b.currentTarget),e=d.parent(".ui-portlet-item");e.remove(),c.fire("resize",e)},_haltHandler:function(a){a.halt()},_initDD:function(){var b=this,c="#"+b.get("id"),d=new i({container:c,move:1,handlers:[".ui-portlet-header"],selector:function(b){return b=a.one(b),b.hasClass("ui-portlet-item")},plugins:[new g({node:function(b){var c=b.get("dragNode")[0].cloneNode(!0);return a.one(c).css("opacity",1)},moveOnEnd:!1,destroyOnEnd:!0})]});new j({container:c,selector:".ui-portlet-item"}),new j({container:c,selector:".ui-portlet-column"}),d.on("dragover",function(a){var b=a.drag,c=a.drop,d=b.get("dragNode"),e=c.get("node");if(d.hasClass(".ui-portlet-item"))if(e.hasClass(".ui-portlet-column")){var f=e.all(".ui-portlet-item");if(f.length&&(1!=f.length||f[0]!==b.get("node")[0]||f[0]===b.get("dragNode")[0]))return;e.append(d)}else{var g=(2*e.offset().top+e.height())/2;if(a.pageY>g){var h=e.next();h&&h[0]==d||d.insertAfter(e)}else{var i=e.prev();i&&i[0]==d||d.insertBefore(e)}}})}};return b.extend(l,{ATTRS:k})},{requires:["base","dom","event","dd","dd/plugin/scroll","dd/plugin/proxy","gallery/gallery/kissy-portal/1.0/index.css"]});